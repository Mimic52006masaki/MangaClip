{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/masaki/Desktop/OriginalApp/MangaClip/lib/database.ts"],"sourcesContent":["import Database from 'better-sqlite3';\nimport path from 'path';\n\nconsole.log('Initializing database module');\n\n// Database path\nconst dbPath = path.join(process.cwd(), 'mangaclip.db');\nconsole.log('DB path:', dbPath);\nconst db = new Database(dbPath);\nconsole.log('DB instance created');\n\n// Enable WAL mode for better concurrency\ndb.pragma('journal_mode = WAL');\n\n// Create tables\nconsole.log('Creating tables...');\ndb.exec(`\n  CREATE TABLE IF NOT EXISTS manga_articles (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    originalTitle TEXT NOT NULL,\n    generatedTitle TEXT,\n    url TEXT NOT NULL UNIQUE,\n    targetDate TEXT,\n    createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,\n    updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,\n    checked BOOLEAN DEFAULT FALSE\n  );\n\n  CREATE TABLE IF NOT EXISTS anime_articles (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    title TEXT NOT NULL,\n    url TEXT NOT NULL UNIQUE,\n    createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,\n    updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP\n  );\n\n  CREATE TABLE IF NOT EXISTS article_date_tags (\n    anchor_post_id INTEGER PRIMARY KEY,\n    date TEXT NOT NULL,\n    createdAt DATETIME DEFAULT CURRENT_TIMESTAMP\n  );\n`);\n\n// Add post_id column if not exists\ntry {\n  db.exec(`ALTER TABLE manga_articles ADD COLUMN post_id INTEGER;`);\n  console.log('Added post_id column');\n} catch (error: any) {\n  // Column might already exist, ignore error\n  console.log('post_id column already exists or error adding:', error?.message);\n}\n\n// Add unique index for post_id if not exists\ntry {\n  db.exec(`CREATE UNIQUE INDEX IF NOT EXISTS idx_manga_articles_post_id ON manga_articles(post_id);`);\n  console.log('Created post_id index');\n} catch (error: any) {\n  console.log('Index creation error:', error?.message);\n}\n\nconsole.log('Tables created successfully');\n\n// Populate existing data with post_id if not set\ntry {\n  const rows = db.prepare('SELECT id, url FROM manga_articles WHERE post_id IS NULL').all() as { id: number; url: string }[];\n  if (rows.length > 0) {\n    const update = db.prepare('UPDATE manga_articles SET post_id = ? WHERE id = ?');\n    for (const row of rows) {\n      const match = row.url.match(/\\/post\\/(\\d+)\\//);\n      if (match) {\n        update.run(Number(match[1]), row.id);\n      }\n    }\n    console.log(`Populated post_id for ${rows.length} existing rows`);\n  }\n} catch (error: any) {\n  console.log('Error populating post_id:', error?.message);\n}\n\n// Types\nexport interface MangaArticle {\n  id: number;\n  originalTitle: string;\n  generatedTitle: string | null;\n  url: string;\n  post_id: number;\n  targetDate: string | null;\n  createdAt: string;\n  updatedAt: string;\n  checked: boolean;\n}\n\nexport interface AnimeArticle {\n  id: number;\n  title: string;\n  url: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface ArticleDateTag {\n  anchor_post_id: number;\n  date: string;\n  createdAt: string;\n}\n\nexport default db;"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,QAAQ,GAAG,CAAC;AAEZ,gBAAgB;AAChB,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACxC,QAAQ,GAAG,CAAC,YAAY;AACxB,MAAM,KAAK,IAAI,qOAAQ,CAAC;AACxB,QAAQ,GAAG,CAAC;AAEZ,yCAAyC;AACzC,GAAG,MAAM,CAAC;AAEV,gBAAgB;AAChB,QAAQ,GAAG,CAAC;AACZ,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;AAyBT,CAAC;AAED,mCAAmC;AACnC,IAAI;IACF,GAAG,IAAI,CAAC,CAAC,sDAAsD,CAAC;IAChE,QAAQ,GAAG,CAAC;AACd,EAAE,OAAO,OAAY;IACnB,2CAA2C;IAC3C,QAAQ,GAAG,CAAC,kDAAkD,OAAO;AACvE;AAEA,6CAA6C;AAC7C,IAAI;IACF,GAAG,IAAI,CAAC,CAAC,wFAAwF,CAAC;IAClG,QAAQ,GAAG,CAAC;AACd,EAAE,OAAO,OAAY;IACnB,QAAQ,GAAG,CAAC,yBAAyB,OAAO;AAC9C;AAEA,QAAQ,GAAG,CAAC;AAEZ,iDAAiD;AACjD,IAAI;IACF,MAAM,OAAO,GAAG,OAAO,CAAC,4DAA4D,GAAG;IACvF,IAAI,KAAK,MAAM,GAAG,GAAG;QACnB,MAAM,SAAS,GAAG,OAAO,CAAC;QAC1B,KAAK,MAAM,OAAO,KAAM;YACtB,MAAM,QAAQ,IAAI,GAAG,CAAC,KAAK,CAAC;YAC5B,IAAI,OAAO;gBACT,OAAO,GAAG,CAAC,OAAO,KAAK,CAAC,EAAE,GAAG,IAAI,EAAE;YACrC;QACF;QACA,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,KAAK,MAAM,CAAC,cAAc,CAAC;IAClE;AACF,EAAE,OAAO,OAAY;IACnB,QAAQ,GAAG,CAAC,6BAA6B,OAAO;AAClD;uCA6Be"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/masaki/Desktop/OriginalApp/MangaClip/app/api/generate-title/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport db from '@/lib/database';\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    if (!body.id) {\n      return NextResponse.json({ success: false, error: 'id required' }, { status: 400 });\n    }\n\n    // Get original title\n    const article = db.prepare('SELECT originalTitle FROM manga_articles WHERE id = ?').get(body.id) as { originalTitle: string } | undefined;\n    if (!article) {\n      return NextResponse.json({ success: false, error: 'Article not found' }, { status: 404 });\n    }\n\n    // Mock AI generation\n    const generatedTitle = `${article.originalTitle}`;\n\n    // Update DB\n    const result = db.prepare(\"UPDATE manga_articles SET generatedTitle = ?, updatedAt = datetime('now') WHERE id = ?\").run(generatedTitle, body.id);\n    if (result.changes === 0) {\n      return NextResponse.json({ success: false, error: 'Update failed' }, { status: 500 });\n    }\n\n    return NextResponse.json({ success: true, generatedTitle });\n  } catch (error) {\n    console.error('Generate title error:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to generate title' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,IAAI,CAAC,KAAK,EAAE,EAAE;YACZ,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,qBAAqB;QACrB,MAAM,UAAU,mKAAE,CAAC,OAAO,CAAC,yDAAyD,GAAG,CAAC,KAAK,EAAE;QAC/F,IAAI,CAAC,SAAS;YACZ,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,qBAAqB;QACrB,MAAM,iBAAiB,GAAG,QAAQ,aAAa,EAAE;QAEjD,YAAY;QACZ,MAAM,SAAS,mKAAE,CAAC,OAAO,CAAC,0FAA0F,GAAG,CAAC,gBAAgB,KAAK,EAAE;QAC/I,IAAI,OAAO,OAAO,KAAK,GAAG;YACxB,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,OAAO,uLAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAe;IAC3D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,uLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAA2B,GACpD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}