{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/masaki/Desktop/OriginalApp/MangaClip/lib/database.ts"],"sourcesContent":["import Database from 'better-sqlite3';\nimport path from 'path';\n\nconsole.log('Initializing database module');\n\n// Database path\nconst dbPath = path.join(process.cwd(), 'mangaclip.db');\nconsole.log('DB path:', dbPath);\nconst db = new Database(dbPath);\nconsole.log('DB instance created');\n\n// Enable WAL mode for better concurrency\ndb.pragma('journal_mode = WAL');\n\n// Create tables\nconsole.log('Creating tables...');\ndb.exec(`\n  CREATE TABLE IF NOT EXISTS manga_articles (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    originalTitle TEXT NOT NULL,\n    generatedTitle TEXT,\n    url TEXT NOT NULL UNIQUE,\n    targetDate TEXT,\n    createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,\n    updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,\n    checked BOOLEAN DEFAULT FALSE\n  );\n\n  CREATE TABLE IF NOT EXISTS anime_articles (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    title TEXT NOT NULL,\n    url TEXT NOT NULL UNIQUE,\n    createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,\n    updatedAt DATETIME DEFAULT CURRENT_TIMESTAMP\n  );\n\n  CREATE TABLE IF NOT EXISTS article_date_tags (\n    anchor_post_id INTEGER PRIMARY KEY,\n    date TEXT NOT NULL,\n    createdAt DATETIME DEFAULT CURRENT_TIMESTAMP\n  );\n`);\n\n// Add post_id column if not exists\ntry {\n  db.exec(`ALTER TABLE manga_articles ADD COLUMN post_id INTEGER;`);\n  console.log('Added post_id column');\n} catch (error: any) {\n  // Column might already exist, ignore error\n  console.log('post_id column already exists or error adding:', error?.message);\n}\n\n// Add unique index for post_id if not exists\ntry {\n  db.exec(`CREATE UNIQUE INDEX IF NOT EXISTS idx_manga_articles_post_id ON manga_articles(post_id);`);\n  console.log('Created post_id index');\n} catch (error: any) {\n  console.log('Index creation error:', error?.message);\n}\n\nconsole.log('Tables created successfully');\n\n// Populate existing data with post_id if not set\ntry {\n  const rows = db.prepare('SELECT id, url FROM manga_articles WHERE post_id IS NULL').all() as { id: number; url: string }[];\n  if (rows.length > 0) {\n    const update = db.prepare('UPDATE manga_articles SET post_id = ? WHERE id = ?');\n    for (const row of rows) {\n      const match = row.url.match(/\\/post\\/(\\d+)\\//);\n      if (match) {\n        update.run(Number(match[1]), row.id);\n      }\n    }\n    console.log(`Populated post_id for ${rows.length} existing rows`);\n  }\n} catch (error: any) {\n  console.log('Error populating post_id:', error?.message);\n}\n\n// Types\nexport interface MangaArticle {\n  id: number;\n  originalTitle: string;\n  generatedTitle: string | null;\n  url: string;\n  post_id: number;\n  targetDate: string | null;\n  createdAt: string;\n  updatedAt: string;\n  checked: boolean;\n}\n\nexport interface AnimeArticle {\n  id: number;\n  title: string;\n  url: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface ArticleDateTag {\n  anchor_post_id: number;\n  date: string;\n  createdAt: string;\n}\n\nexport default db;"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,QAAQ,GAAG,CAAC;AAEZ,gBAAgB;AAChB,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACxC,QAAQ,GAAG,CAAC,YAAY;AACxB,MAAM,KAAK,IAAI,qOAAQ,CAAC;AACxB,QAAQ,GAAG,CAAC;AAEZ,yCAAyC;AACzC,GAAG,MAAM,CAAC;AAEV,gBAAgB;AAChB,QAAQ,GAAG,CAAC;AACZ,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;AAyBT,CAAC;AAED,mCAAmC;AACnC,IAAI;IACF,GAAG,IAAI,CAAC,CAAC,sDAAsD,CAAC;IAChE,QAAQ,GAAG,CAAC;AACd,EAAE,OAAO,OAAY;IACnB,2CAA2C;IAC3C,QAAQ,GAAG,CAAC,kDAAkD,OAAO;AACvE;AAEA,6CAA6C;AAC7C,IAAI;IACF,GAAG,IAAI,CAAC,CAAC,wFAAwF,CAAC;IAClG,QAAQ,GAAG,CAAC;AACd,EAAE,OAAO,OAAY;IACnB,QAAQ,GAAG,CAAC,yBAAyB,OAAO;AAC9C;AAEA,QAAQ,GAAG,CAAC;AAEZ,iDAAiD;AACjD,IAAI;IACF,MAAM,OAAO,GAAG,OAAO,CAAC,4DAA4D,GAAG;IACvF,IAAI,KAAK,MAAM,GAAG,GAAG;QACnB,MAAM,SAAS,GAAG,OAAO,CAAC;QAC1B,KAAK,MAAM,OAAO,KAAM;YACtB,MAAM,QAAQ,IAAI,GAAG,CAAC,KAAK,CAAC;YAC5B,IAAI,OAAO;gBACT,OAAO,GAAG,CAAC,OAAO,KAAK,CAAC,EAAE,GAAG,IAAI,EAAE;YACrC;QACF;QACA,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,KAAK,MAAM,CAAC,cAAc,CAAC;IAClE;AACF,EAAE,OAAO,OAAY;IACnB,QAAQ,GAAG,CAAC,6BAA6B,OAAO;AAClD;uCA6Be"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/masaki/Desktop/OriginalApp/MangaClip/app/api/article_date_tags/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport db, { ArticleDateTag } from '@/lib/database';\n\nexport async function GET() {\n  try {\n    const tags = db.prepare('SELECT * FROM article_date_tags ORDER BY anchor_post_id DESC').all() as ArticleDateTag[];\n    return NextResponse.json({ success: true, tags });\n  } catch (error) {\n    console.error('Error fetching article date tags:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to fetch article date tags' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    if (body.anchor_post_id && body.date) {\n      const insert = db.prepare(`\n        INSERT OR REPLACE INTO article_date_tags (anchor_post_id, date)\n        VALUES (?, ?)\n      `);\n      insert.run(body.anchor_post_id, body.date);\n      return NextResponse.json({ success: true });\n    } else {\n      return NextResponse.json({ success: false, error: 'anchor_post_id and date required' }, { status: 400 });\n    }\n  } catch (error) {\n    console.error('Error creating article date tag:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to create article date tag' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(request: Request) {\n  try {\n    const body = await request.json();\n    if (body.anchor_post_id && body.date) {\n      const update = db.prepare(`\n        UPDATE article_date_tags SET date = ? WHERE anchor_post_id = ?\n      `);\n      const result = update.run(body.date, body.anchor_post_id);\n      if (result.changes === 0) {\n        return NextResponse.json({ success: false, error: 'Article date tag not found' }, { status: 404 });\n      }\n      return NextResponse.json({ success: true });\n    } else {\n      return NextResponse.json({ success: false, error: 'anchor_post_id and date required' }, { status: 400 });\n    }\n  } catch (error) {\n    console.error('Error updating article date tag:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to update article date tag' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function DELETE(request: Request) {\n  try {\n    const body = await request.json();\n    if (body.anchor_post_id) {\n      const del = db.prepare('DELETE FROM article_date_tags WHERE anchor_post_id = ?');\n      const result = del.run(body.anchor_post_id);\n      if (result.changes === 0) {\n        return NextResponse.json({ success: false, error: 'Article date tag not found' }, { status: 404 });\n      }\n      return NextResponse.json({ success: true });\n    } else {\n      return NextResponse.json({ success: false, error: 'anchor_post_id required' }, { status: 400 });\n    }\n  } catch (error) {\n    console.error('Error deleting article date tag:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to delete article date tag' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO,mKAAE,CAAC,OAAO,CAAC,gEAAgE,GAAG;QAC3F,OAAO,uLAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,uLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAoC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,IAAI,KAAK,cAAc,IAAI,KAAK,IAAI,EAAE;YACpC,MAAM,SAAS,mKAAE,CAAC,OAAO,CAAC,CAAC;;;MAG3B,CAAC;YACD,OAAO,GAAG,CAAC,KAAK,cAAc,EAAE,KAAK,IAAI;YACzC,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C,OAAO;YACL,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QACxG;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,uLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAoC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,IAAI,KAAK,cAAc,IAAI,KAAK,IAAI,EAAE;YACpC,MAAM,SAAS,mKAAE,CAAC,OAAO,CAAC,CAAC;;MAE3B,CAAC;YACD,MAAM,SAAS,OAAO,GAAG,CAAC,KAAK,IAAI,EAAE,KAAK,cAAc;YACxD,IAAI,OAAO,OAAO,KAAK,GAAG;gBACxB,OAAO,uLAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAO,OAAO;gBAA6B,GAAG;oBAAE,QAAQ;gBAAI;YAClG;YACA,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C,OAAO;YACL,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAmC,GAAG;gBAAE,QAAQ;YAAI;QACxG;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,uLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAoC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,OAAO,OAAgB;IAC3C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,IAAI,KAAK,cAAc,EAAE;YACvB,MAAM,MAAM,mKAAE,CAAC,OAAO,CAAC;YACvB,MAAM,SAAS,IAAI,GAAG,CAAC,KAAK,cAAc;YAC1C,IAAI,OAAO,OAAO,KAAK,GAAG;gBACxB,OAAO,uLAAY,CAAC,IAAI,CAAC;oBAAE,SAAS;oBAAO,OAAO;gBAA6B,GAAG;oBAAE,QAAQ;gBAAI;YAClG;YACA,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C,OAAO;YACL,OAAO,uLAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/F;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,uLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAoC,GAC7D;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}